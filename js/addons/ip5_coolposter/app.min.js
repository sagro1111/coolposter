function image(a){try{initCanvas(a),ip5SplitsRetrieveData()}catch(g){console.log("image",g)}}
function ip5SplitsRetrieveData(){try{var a=$.parseJSON('[{"name":"\u0424\u0438\u0433\u0443\u0440\u0430","splits":[{"id":"1","rectangles":[{"x":6.1139896373058,"y":10,"width":281.82696145101,"height":373.46468865742},{"x":313.60103626943,"y":10.91743119266,"width":277.07411777779,"height":370.71236113616}]},{"id":"2","rectangles":[{"x":10,"y":10,"width":574.8385734257,"height":176.21185014104},{"x":10.777202072539,"y":207.24770642202,"width":573.28417496204,"height":172.56161280304}]},{"id":"4","rectangles":[{"x":20.880829015544,"y":10,"width":182.3427284754,"height":372.54724620677},{"x":409.97409326425,"y":8.1651376146789,"width":171.88826862104,"height":376.21701568079},{"x":222.95336787565,"y":9.0825688073394,"width":167.57529750704,"height":374.38213105332}]},{"id":"5","rectangles":[{"x":10,"y":10,"width":574.06137420551,"height":107.39824533506},{"x":9.2227979274611,"y":135.77981651376,"width":574.83856201847,"height":111.0073621806},{"x":8.4455958549223,"y":266.88073394495,"width":574.06137420551,"height":112.00111035826}]}]},{"name":"\u0421\u043b\u043e\u0436\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u044b","splits":[{"id":"3","rectangles":[{"x":10,"y":10,"width":50,"height":50},{"x":261.03626943005,"y":276.05504587156,"width":50,"height":50},{"x":481.76165803109,"y":12.752293577982,"width":50,"height":50},{"x":269.58549222798,"y":32.018348623853,"width":50,"height":50}]}]},{"name":"\u042d\u043a\u0441\u043a\u043b\u044e\u0437\u0438\u0432","splits":[{"id":"6","rectangles":[{"x":9.9999999999999,"y":11.834862385321,"width":227.43245850626,"height":172.39233708965},{"x":10.777202072539,"y":199.90825688073,"width":225.86733795507,"height":172.76092609536},{"x":251.70984455959,"y":11.834862385321,"width":180.80170059098,"height":171.62443368025},{"x":252.48704663212,"y":201.74311926605,"width":178.45657180961,"height":171.13574526723},{"x":446.78756476684,"y":13.669724770642,"width":139.59455452207,"height":168.87197697164},{"x":448.34196891192,"y":204.49541284404,"width":137.2802967147,"height":167.97472067529}]}]}]');initMenu(a)}catch(g){console.log("ip5SplitsRetrieveData",
    g)}}var splits=$.parseJSON('[{"name":"\u041f\u0440\u043e\u0441\u0442\u044b\u0435 \u0444\u0438\u0433\u0443\u0440\u044b","splits":[{"id":"1","rectangles":[{"x":6.1139896373058,"y":10,"width":281.82696145101,"height":373.46468865742},{"x":313.60103626943,"y":10.91743119266,"width":277.07411777779,"height":370.71236113616}]},{"id":"2","rectangles":[{"x":10,"y":10,"width":574.8385734257,"height":176.21185014104},{"x":10.777202072539,"y":207.24770642202,"width":573.28417496204,"height":172.56161280304}]},{"id":"4","rectangles":[{"x":20.880829015544,"y":10,"width":182.3427284754,"height":372.54724620677},{"x":409.97409326425,"y":8.1651376146789,"width":171.88826862104,"height":376.21701568079},{"x":222.95336787565,"y":9.0825688073394,"width":167.57529750704,"height":374.38213105332}]},{"id":"5","rectangles":[{"x":10,"y":10,"width":574.06137420551,"height":107.39824533506},{"x":9.2227979274611,"y":135.77981651376,"width":574.83856201847,"height":111.0073621806},{"x":8.4455958549223,"y":266.88073394495,"width":574.06137420551,"height":112.00111035826}]}]},{"name":"\u0421\u043b\u043e\u0436\u043d\u044b\u0435 \u0444\u043e\u0440\u043c\u044b","splits":[{"id":"3","rectangles":[{"x":10,"y":10,"width":50,"height":50},{"x":261.03626943005,"y":276.05504587156,"width":50,"height":50},{"x":481.76165803109,"y":12.752293577982,"width":50,"height":50},{"x":269.58549222798,"y":32.018348623853,"width":50,"height":50}]}]},{"name":"\u042d\u043a\u0441\u043a\u043b\u044e\u0437\u0438\u0432","splits":[{"id":"6","rectangles":[{"x":9.9999999999999,"y":11.834862385321,"width":227.43245850626,"height":172.39233708965},{"x":10.777202072539,"y":199.90825688073,"width":225.86733795507,"height":172.76092609536},{"x":251.70984455959,"y":11.834862385321,"width":180.80170059098,"height":171.62443368025},{"x":252.48704663212,"y":201.74311926605,"width":178.45657180961,"height":171.13574526723},{"x":446.78756476684,"y":13.669724770642,"width":139.59455452207,"height":168.87197697164},{"x":448.34196891192,"y":204.49541284404,"width":137.2802967147,"height":167.97472067529}]}]}]');
function Poster(a){function g(b){b.setWidth(b.width*b.scaleX);b.setHeight(b.height*b.scaleY);b.setScaleX(1);b.setScaleY(1)}function t(a){a=new fabric.Rect({left:a.x,top:a.y,width:a.width,height:a.height,fill:"rgba(255,255,255,.2)",strokeWidth:1,stroke:b.borderColor,lockRotation:!0,hasRotatingPoint:!1,cornerSize:8});a.on("moving",function(){f(this);e(this)});a.on("scaling",function(){g(this);e(this);var b;this.get("width");b=this.get("top");this.get("height");0>=this.get("left")||d.getWidth();0>=b||
d.getHeight()});var f=function(c){var a,f,e,h,p,k;g(c);a=c.get("width");f=c.get("height");e=c.get("left");h=c.get("left")+c.get("width");p=c.get("top");k=c.get("top")+c.get("height");0>e&&c.set("left",0);h>d.getWidth()&&c.set("left",d.getWidth()-a);0>p&&c.set("top",0);k>d.getHeight()&&c.set("top",d.getHeight()-f);d.forEachObject(function(a){var f,l,m;f=a.get("width");l=a.get("height");m=a.get("top");a=a.get("left");f=a+f;l+=m;0>a||f>d.getWidth()||0>m||l>d.getHeight()||(e-b.adhesionScale<f&&e+b.adhesionScale>
f&&(c.left=f),h-b.adhesionScale<a&&h+b.adhesionScale>a&&(c.left=a-c.width-1),p-b.adhesionScale<l&&p+b.adhesionScale>l&&(c.top=l),k+b.adhesionScale>m&&k-b.adhesionScale<m&&(c.top=m-c.height),e-b.adhesionScale<a&&e+b.adhesionScale>a&&(c.left=a),h-b.adhesionScale<f&&h+b.adhesionScale>f&&(c.left=f-c.width),p-b.adhesionScale<m&&p+b.adhesionScale>m&&(c.top=m),k+b.adhesionScale>l&&k-b.adhesionScale<l&&(c.top=l-c.height))})},e=function(){d.forEachObject(function(c){var a,f,e,h,g,k;a=c.get("width");f=c.get("top");
    e=c.get("height");h=c.get("left");g=h+a;k=e+f;var n=!1;d.forEachObject(function(b){if(b!==c){var a,e,d;a=b.get("width");e=b.get("height");d=b.get("top");b=b.get("left");h<b+a&&g>b&&f<e+d&&k>d&&(n=!0)}});n?c.set("stroke","red"):c.set("stroke",b.borderColor)})};(function(a){a.set("left",a.get("left")*b.scaleCanvas);a.set("top",a.get("top")*b.scaleCanvas);a.set("width",a.get("width")*b.scaleCanvas);a.set("height",a.get("height")*b.scaleCanvas)})(a);d.add(a)}function u(){b.image&&(d.setBackgroundImage(b.image),
    d.renderAll())}function v(a){try{d.clear(),u(b.image),d.renderAll(),a.forEach(function(b){t(b)})}catch(f){console.log("_redraw",f)}}var n={},d={},b={},w=this;b.history=[];b.blocked=!0;b.scaleCanvas=a.scale;b.domElement=a.elem;b.image=a.bg;b.templateId=b.templateId||a.id;b.borderColor="rgb(100,200,200)";b.adhesionScale=15;var q=function(a){0<=b.current?(n[b.templateId]={canvas:d},n[b.templateId].rectangles=b.history[b.current]):a.forEach(function(a){a.splits.forEach(function(a){if(a.id==b.templateId){var c=
    a.id;n[c]={canvas:d};n[c].rectangles=a.rectangles}})})},r=function(b){try{v(n[b].rectangles)}catch(a){console.log("_addShape",a)}};this.chooseTemplate=function(a){b.templateId=a||b.templateId;q(splits);r(b.templateId)};this.setScale=function(a){b.scaleCanvas=a;q(splits);r(b.templateId)};this.historyNext=function(){console.log(b.current,b.history.length);b.current<=b.history.length-2&&(b.current+=1,q(splits),r(b.templateId))};this.historyPrev=function(){0<=b.current&&(--b.current,q(splits),r(b.templateId))};
    this.getCoordinates=function(){return b.history[b.current]};this.init=function(a){q(splits);a?(d=new fabric.Canvas(b.domElement,{selection:!1}),d.on("mouse:up",function(){var a=d._objects,e=[];if(0!==a.length){for(var c in a)a.hasOwnProperty(c)&&(e[c]={},e[c].x=a[c].get("left"),e[c].y=a[c].get("top"),e[c].width=a[c].get("width"),e[c].height=a[c].get("height"));n[b.templateId].rectangles=e;b.history.push(e);console.log(b.history);b.current=b.history.length-1}})):d=new fabric.StaticCanvas(b.domElement,
        {selection:!1});u(b.image);r(b.templateId);setTimeout(function(){w.chooseTemplate()},10)}}var cp=new Poster({elem:document.querySelector("#canvas"),bg:"img/img.jpg",canvasWidth:671,canvasHeight:465,splits:splits,id:6,scale:1});cp.init();
$(document).ready(function(){$("canvas").on("click",function(a){a.preventDefault()});$(".picture-options-btn-prev").on("click",function(a){a.preventDefault();cp.historyPrev()});$(".picture-options-btn-next").on("click",function(a){a.preventDefault();cp.historyNext()});$("#scale-slipper").on("input",function(){var a=1-.01*$(this).val();cp.setScale(a)});$("#unlock-button").on("click",function(a){a.preventDefault();cp.init(!0)});view_material($(".choose-material-link"),$("#material-value"));$(".choose-material-link").on("click",
    function(a){a.preventDefault();view_material($(this),$("#material-value"))});view_size($("#size-value"),68,45)});var view_size=function(a,g,t){a.html(g+" \u0441\u043c x "+t+" \u0441\u043c")},view_material=function(a,g){g.html(a.html())};